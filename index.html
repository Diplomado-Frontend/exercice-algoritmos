<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script type="text/javascript">

        const calculateTotal = () => {

            //When the input values has change, remove the previous final message with the total calculate.
            const divTotalCourse = document.getElementById('totalCourse');
            divTotalCourse.innerHTML='';
           
            const formDomElem = document.getElementsByClassName('courseQuantityClass');
            let totalCourse = 0;

            //Get each input element to get is value and sum to return the total course calculate.
            for (let index = 0; index < formDomElem.length; index++) {
                const element = formDomElem[index];

                if(element.localName === 'input'){
                    let inputId = element.attributes[1].nodeValue;
                    let inputValue = document.getElementById(inputId).value;
                    if (inputValue === '') 
                    {
                        alert('Debe ingresar un valor para cada materia');
                        return;
                    } else if (isNaN(inputValue)){
                        alert(`${inputValue} no es un número`);
                        return;
                    } else {
                        totalCourse +=  parseFloat(inputValue);
                    }
    
                   
                }        
            }

            //Into div parent to display the calculated total value to pay.
            let parent = document.getElementById("totalCourse");
            let label = document.createElement("label");
            label.innerHTML = `El valor total a pagar por las materias matriculadas es de: ${totalCourse} `;
            parent.appendChild(label);

        }

        window.addEventListener('keyup', function(event) {
            event.preventDefault();
            if (event.code === 'Enter') {        
                 const inputValue = document.getElementById("courseQuantity").value;
                 processCourseQuantity(inputValue);

            }
        });

        const createCourseQuantity = () => {
            const inputValue = document.getElementById("courseQuantity").value;
            processCourseQuantity(inputValue);
        }

        const processCourseQuantity = (inputValue) => {

            if(inputValue <= 0 || inputValue > 1000) alert("Ingrese un valor correcto para la cantidad de materias.");
            else {

                //check each input when his value was change, to update the input quantity displayed in the dom.
                clearDomElement('courseQuantityClass');
                clearDomElement('StainerClass');
                clearDomElement('StudentCardClass');
                clearDomElement('containerDiscount');              
               
                /*Acording with the course quantity added for the user, create in the dom his asociate section: label + input
                for each course. */
                for (let index = 0; index < inputValue; index++) {
       
                    //Start index in 1.
                    const element = index + 1;
                    createElement("Ingrese el costo de la materia: ", "courseQuantityClass", "containerCourseQuantity");
                }

                createElement("Costo de papelería: ", "StainerClass", "containerStainer", "20000");
                createElement("Costo de Carné: ", "StudentCardClass", "containerStudentCard", "8000");                
                createElement("Descuento: ", "DiscountClass", "containerDiscount", "20");                
            }

        }

        const createElement = (labelMessage, classNameAttr, nameParentCont, value) => {

            //Create Stainer elements to set into dom.
            let input = document.createElement("input");
            let label = document.createElement("label");
            let br = document.createElement("br");

            setAttributes(input, label, br, 0, labelMessage, classNameAttr, value);
            //Into div parent, add the label + input + br. 
            setChildsToParent(nameParentCont, label, input, br);
        }

        const setAttributes = (input, label, br, currentIndex, labelMessage, classAttribute, value) => {

            //Set attributes for each element.
            input.setAttribute('type', 'text');
            input.setAttribute('id', `course${currentIndex}`);
            label.setAttribute("for",`course${currentIndex}`);
            label.innerHTML = currentIndex > 0 ? `${labelMessage} ${currentIndex} ` : labelMessage;
            input.setAttribute('class', classAttribute);
            label.setAttribute('class', classAttribute);

            if(value !== undefined) 
                input.setAttribute('value', value);

            br.setAttribute('class', classAttribute); 

        }

        const setChildsToParent = (parentId, label, input, br) => {
            let parent = document.getElementById(parentId);
            parent.appendChild(label);
            parent.appendChild(input);
            parent.appendChild(br);
        }

        const clearDomElement = (classNameElement) => {

            const formDomElem = document.getElementsByClassName(classNameElement);

            //check each input when his value was change, to update the input quantity displayed in the dom.
            if(formDomElem.length > 0) 
            {
                while (formDomElem[0] !== undefined) {
                    formDomElem[0].remove()
                }
            } 
        }

    </script>

</head>
<body>
    <form action="" id="input-form" onsubmit="return false">
        <label for="">Ingrese nombre estudiante: </label>
        <input type="text" id="studentName">
        </br>
        <label for="">Ingrese cantidad de materias:</label>
        <input type="text" id="courseQuantity" onfocusout="createCourseQuantity()">
        <div id="containerCourseQuantity"></div>
        <div id="containerStainer"></div>
        <div id="containerStudentCard"></div>
        <div id="containerDiscount"></div>
        <input type="button" onclick="calculateTotal()" value="Calcular">
        <div id="totalCourse"></div>
    </form>
</body>
</html>